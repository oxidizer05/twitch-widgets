{"version":3,"sources":["node_modules/browser-pack/_prelude.js","node_modules/ts-raz-util/dist/index.js","src/frontend/js/draw.js","src/frontend/js/request.js"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","Object","defineProperty","value","f_precentWhatLeft","f_moduleName","bitRotate","deepCopy","shallowCopy","bin2dec","dec2bin","escapeJSON","time","factorial","getKey","renameKey","sleep","precentWhat","precentWhatLeft","mod","timestamp","caclms","isPrimitive","moduleNameEx","moduleName","firstMatch","commandArgs","REGEX_BASE64","REGEX_QUOTES","REGEX_COMMAND_LINE","REGEX_FILENAME","s","m","match","map","replace","regex","undefined","filename","parent","val","h","Math","floor","Date","now","x","current","max","ms","Promise","res","setTimeout","obj","oldKey","newKey","_a","assign","keys","find","key","getMinutes","getSeconds","getMilliseconds","dec","toString","bin","Number","parseInt","JSON","parse","stringify","right","slice","request","timerCountdown","isWaitsForWinner","timerApi","setInterval","drawCallback","httpRequest","readyState","status","data","responseText","console","log","document","querySelector","innerHTML","userCount","command","text","endTimestamp","seconds","lastWinner","completeDrawing","sendWinnerRequset","updateTimerElement","clearInterval","countdownSeconds","formatTime","num","countdown","min","sec","winner","classList","add","remove","url","callback","window","XMLHttpRequest","overrideMimeType","ActiveXObject","onreadystatechange","open","send"],"mappings":"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","file":"draw.min.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.f_precentWhatLeft = exports.f_moduleName = exports.bitRotate = exports.deepCopy = exports.shallowCopy = exports.bin2dec = exports.dec2bin = exports.escapeJSON = exports.time = exports.factorial = exports.getKey = exports.renameKey = exports.sleep = exports.precentWhat = exports.precentWhatLeft = exports.mod = exports.timestamp = exports.caclms = exports.isPrimitive = exports.moduleNameEx = exports.moduleName = exports.firstMatch = exports.commandArgs = exports.REGEX_BASE64 = exports.REGEX_QUOTES = exports.REGEX_COMMAND_LINE = exports.REGEX_FILENAME = void 0;\r\nexports.REGEX_FILENAME = /[^/\\\\]+\\.(.+)$/;\r\nexports.REGEX_COMMAND_LINE = /\".+\"|'.+'|\\S+/g;\r\nexports.REGEX_QUOTES = /^\"|\"$|^'|'$/g;\r\nexports.REGEX_BASE64 = /^data:([+/A-Za-z-]+);base64,(.+)$/;\r\nexports.commandArgs = function (s) { var m = s.match(exports.REGEX_COMMAND_LINE); if (m)\r\n    return m.map(function (s) { return s.replace(exports.REGEX_QUOTES, \"\"); }); };\r\nexports.firstMatch = function (s, regex) { var r = s.match(regex); return r ? r[0] : undefined; };\r\nexports.moduleName = function (m) { return exports.firstMatch(m.filename, exports.REGEX_FILENAME) || \"NULL!\"; };\r\nexports.moduleNameEx = function () { return module.parent ? (exports.firstMatch(module.parent.filename, exports.REGEX_FILENAME) || \"NULL!\") : \"NULL!\"; };\r\nexports.isPrimitive = function (val) { return val === null || (typeof val !== \"object\" && typeof val !== \"function\"); };\r\nexports.caclms = function (h, m, s) {\r\n    if (m === void 0) { m = 0; }\r\n    if (s === void 0) { s = 0; }\r\n    return (h * 3600 + m * 60 + s) * 1000;\r\n};\r\nexports.timestamp = function () { return Math.floor(Date.now() / 1000); };\r\nexports.mod = function (x, n) { return (x % n + n) % n; };\r\nexports.precentWhatLeft = function (current, max) { return Math.floor((max - current) / max * 100); };\r\nexports.precentWhat = function (current, max) { return Math.floor(current * 100 / max); };\r\nexports.sleep = function (ms) { return new Promise(function (res) { setTimeout(res, ms); }); };\r\nexports.renameKey = function (obj, oldKey, newKey) {\r\n    var _a;\r\n    delete Object.assign(obj, (_a = {}, _a[newKey] = obj[oldKey], _a))[oldKey];\r\n};\r\nexports.getKey = function (obj, value) { return Object.keys(obj).find(function (key) { return obj[key] === value; }); };\r\nexports.factorial = function (n) { return n <= 1 ? 1 : n * exports.factorial(n - 1); };\r\nexports.time = function () { var time = new Date(); return time.getMinutes() + \":\" + time.getSeconds() + \":\" + time.getMilliseconds(); };\r\nexports.escapeJSON = function (s) { return s.replace(/\\\\n/g, \"\\\\n\").replace(/\\\\'/g, \"\\\\'\").replace(/\\\\\"/g, '\\\\\"').replace(/\\\\&/g, \"\\\\&\").replace(/\\\\r/g, \"\\\\r\").replace(/\\\\t/g, \"\\\\t\").replace(/\\\\b/g, \"\\\\b\").replace(/\\\\f/g, \"\\\\f\"); };\r\nexports.dec2bin = function (dec) { return (dec >>> 0).toString(2); };\r\nexports.bin2dec = function (bin) { return Number.parseInt(bin, 2) >> 0; };\r\nexports.shallowCopy = function (obj) { return Object.assign({}, obj); };\r\nexports.deepCopy = function (obj) { return JSON.parse(JSON.stringify(obj)); };\r\nfunction bitRotate(n, m, right) {\r\n    var bin = exports.dec2bin(n);\r\n    m %= bin.length;\r\n    return exports.bin2dec(right ? bin.slice(-m) + bin.slice(0, -m) : bin.slice(m) + bin.slice(0, m));\r\n}\r\nexports.bitRotate = bitRotate;\r\nexports.f_moduleName = function (m) { return \"[\" + exports.moduleName(m) + \"]\"; };\r\nexports.f_precentWhatLeft = function (current, max) { return exports.precentWhatLeft(current, max) + \"%\"; };\r\n","const request = require(\"./request\");\r\nconst { timestamp } = require(\"ts-raz-util\");\r\n\r\nlet timerCountdown, isWaitsForWinner;\r\n\r\nconst timerApi = setInterval(() => {\r\n    request(\"http://localhost/api/draw\", drawCallback);\r\n}, 1000);\r\n\r\nfunction drawCallback(httpRequest) {\r\n    if (httpRequest.readyState == 4) {\r\n        if (httpRequest.status == 200) {\r\n            const data = JSON.parse(httpRequest.responseText);\r\n            console.log(data);\r\n\r\n            if (!data)\r\n                return;\r\n\r\n            document.querySelector(\".draw-voted\").innerHTML = data.userCount;\r\n            document.querySelector(\".draw-command\").innerHTML = data.command;\r\n            document.querySelector(\".draw-text\").innerHTML = data.text;\r\n\r\n            if (data.endTimestamp) {\r\n                if (!timerCountdown && !isWaitsForWinner) {\r\n                    let seconds = data.endTimestamp - timestamp();\r\n\r\n                    // The browser has been refreshed\r\n                    if (seconds < 1) {\r\n                        if (data.lastWinner)\r\n                            completeDrawing(data.lastWinner);\r\n                        else\r\n                            sendWinnerRequset();\r\n\r\n                        updateTimerElement(0);\r\n                        return;\r\n                    }\r\n\r\n                    timerCountdown = setInterval(() => {\r\n                        updateTimerElement(seconds);\r\n\r\n                        if (seconds < 1) {\r\n                            clearInterval(timerCountdown);\r\n                            sendWinnerRequset();\r\n                        }\r\n                        else\r\n                            seconds--;\r\n                    }, 1000);\r\n                }\r\n            }\r\n            else\r\n                updateTimerElement(data.countdownSeconds);\r\n        }\r\n        else {\r\n            console.log(\"С запросом возникла проблема. status: \" + httpRequest.status);\r\n\r\n            if (timerCountdown)\r\n                clearInterval(timerCountdown);\r\n            timerCountdown = undefined;\r\n        }\r\n    }\r\n}\r\n\r\nconst formatTime = (num) => num > 9 ? num : (\"0\" + num);\r\n\r\nfunction updateTimerElement(countdown) {\r\n    const min = Math.floor(countdown / 60);\r\n    const sec = Math.floor(countdown % 60);\r\n    document.querySelector(\".draw-countdown\").innerHTML = formatTime(min) + \":\" + formatTime(sec);\r\n}\r\n\r\nfunction sendWinnerRequset() {\r\n    console.log(\"sendWinnerRequset\");\r\n    isWaitsForWinner = true;\r\n\r\n    request(\"http://localhost/api/draw/winner\", (httpRequest) => {\r\n        if (httpRequest.readyState == 4) {\r\n            if (httpRequest.status == 200)\r\n                completeDrawing(httpRequest.responseText);\r\n            else {\r\n                isWaitsForWinner = false;\r\n                console.log(\"С запросом возникла проблема. status: \" + httpRequest.status);\r\n            }\r\n        }\r\n    });\r\n}\r\n\r\nfunction completeDrawing(winner) {\r\n    console.log(\"completeDrawing > Winner: \" + winner);\r\n    clearInterval(timerApi);\r\n\r\n    document.querySelector(\".draw\").classList.add(\"opacity-none\");\r\n    document.querySelector(\".winner-name\").innerHTML = winner;\r\n\r\n    setTimeout(() => {\r\n        document.querySelector(\".draw\").classList.add(\"hidden\");\r\n        document.querySelector(\".winner\").classList.remove(\"opacity-none\");\r\n    }, 1500);\r\n}","module.exports = (url, callback) => {\r\n    let httpRequest;\r\n\r\n    if (window.XMLHttpRequest) { // Mozilla, Safari, ...\r\n        httpRequest = new XMLHttpRequest();\r\n        if (httpRequest.overrideMimeType) {\r\n            httpRequest.overrideMimeType(\"application/json\");\r\n        }\r\n    }\r\n    else if (window.ActiveXObject) { // IE\r\n        try {\r\n            httpRequest = new ActiveXObject(\"Msxml2.XMLHTTP\");\r\n        } catch {\r\n            try {\r\n                httpRequest = new ActiveXObject(\"Microsoft.XMLHTTP\");\r\n            } catch { }\r\n        }\r\n    }\r\n\r\n    if (!httpRequest) {\r\n        console.log(\"Не вышло :( Невозможно создать экземпляр класса XMLHTTP \");\r\n        return;\r\n    }\r\n\r\n    httpRequest.onreadystatechange = () => callback(httpRequest);\r\n    httpRequest.open(\"GET\", url, true);\r\n    httpRequest.send(null);\r\n};"]}