# Руководство пользователя приложения Twitch-events 
# Описание
Twitch-events — это консольное приложение предоставляющее дополнительные чат команды и виджеты для стримеров платформы Twitch.  
![](https://github.com/raziEiL/twitch-events/blob/master/git-img/0.png "Voting widget demonstarion")
# Особенности
* Создание событий: голосование и розыгрыш с помощью чат команд
* Виджеты для просмотра прогресса событий и интеграции с OBS
* Быстры запуск приложения без лишних настроек и установок стороннего ПО
* Возможность переименовывать Twitch команды по вашему желанию
# Установка и запуск
1. Добавьте бота на ваш Twitch канал с помощью [ссылки подключения](https://twitchapps.com/tmi/)
2. Скопируйте сгенерированный пароль авторизации (Twitch Chat OAuth Password)
3. Скачайте [последнюю версию приложения](https://github.com/raziEiL/twitch-events/releases), и откройте любым текстовым редактором файл конфигурации `config.json`
4. Вставьте ранее скопированный пароль авторизации напротив ключа `password` и напишите название своего канала напротив ключа `login`. Значения обязательно должны быть заключены в двойные кавычки! 
<details>
  <summary>Пример правильно отредактированного файла конфигурации</summary>
```json
{
    "twitch": {
            "password": "oauth:1kxfnxefds3t8zupbm67fhsxd9z1fj",
            "login": "razie1l",
            "httpPort": 80,
            "ircPort": 433
        },
}
```
</details>
5. Запустите приложение `twitch-events`.
<details>
    <summary>Cобщение в консоли при успешном запуске</summary>
```
Http server listening at http://localhost:80
Connected to razie1l Twitch channel
```
</details>
6. Для просмотра данных перейдите на веб-сайт http://localhost:80. Сайт доступен только на вашей локальной машине и не "виден" из интернета.
# Команды
Каждая команда имеет приставку — специальный единый символ, который помогает идентифицировать команды и отделить их от простого текста в чате Twitch. По умолчанию приложение использует символ `!` в качестве приставки.
## !vote
Команда позволяет стримеру создавать голосования для пользователей между двумя участниками. Голосование неограниченно по времени.
### Использование
После команды `!vote` перечислите участников голосования через пробел, например `!vote Fnatic NaVi` (имена участников не должны содержать пробелы и спец. символы). 

После выполнения команды голосование считается открытым, виджет голосования будет доступен по адресу http://localhost:80/vote. Пользователи вашего канала теперь могут отдать свой голос за участника с помощью команды соответствующей его имени. Например `!NaVi`. 

Для завершения голосования стримеру нужно написать команду `!vote`. Список голосов пользователей доступен по адресу http://localhost/vote/list

## !draw
Команда позволяет стримеру создавать розыгрыши для пользователей за отведенное время.
### Использование
После команды `!draw` через пробел укажите время в минутах, которое должен длится розыгрыш. Далее через пробел укажите текст, который будет отображаться в виджете на сайте. Обязательно заключите текст в двойные кавычки!

Пример: `!draw 5 "УЧАСТВУЙТЕ В РОЗЫГРЫШЕ КРЕДИТОВ!"`

Для запуска розыгрыша напишите команду `!drawstart`. Пользователи вашего канала теперь могут принять участие в розыгрыше с помощью команды `!draw`. По истечению времени на виджете отобразиться победитель, который будет выбран случайным образом.
# Настройки
Настройки приложения задаются в файл конфигурации `config.json`, который находится в корневой директории приложения. Файл имеет расширение `json`.

`JSON` — это простой формат обмена данными состоящий из коллекции пар ключ/значение.  
`Объект` — неупорядоченный набор пар ключ/значение. Объект начинается с `{` *открывающей фигурной скобки* и заканчивается `}` *закрывающей фигурной скобкой*. Каждое имя ключа сопровождается `:` *двоеточием*, пары ключ/значение разделяются `,` *запятой*.
<details>
  <summary>Примеры</summary>
    Простой объект
```json
    "pewdiepie"
    {
        "followers": 10000000
    }
```
    Объект вложенный в дргой объект
    ```json
    "vloggers": {
        "pewdiepie"
        {
            "followers": 10000000
        }
    }
```
</details>
В файл содержит три основных объекта настроек с именами: `twitch`, `commands`, `debug`. Рассмотрим только первые два объекта отвечающие за пользовательские настройки.

## twitch
Объект настроек хранит данные авторизации к Twitch API и настройки портов локального веб-сайта.
<details>
  <summary>Объект twitch</summary>
```json
{
    "twitch": {
        "password": "oauth:j8sw4m4ao19551vdpidp5e0c3zxguc",
        "login": "razie1l",
        "httpPort": 80,
        "ircPort": 433
    },
}
```
</details>
| Ключ | Значение | Примечание |
|------|----------|------------|
|password|Пароль авторизации (Twitch OAuth)|[Ссылка генерации пароля](https://twitchapps.com/tmi/)<br>*Значение обязательно должно быть заключено в двойные кавычки!*|
|login|Логин Twitch/название канала|*Значение обязательно должно быть заключено в двойные кавычки!*|
|httpPort|Порт для веб-севера|[Решение проблемы недоступности веб-сайта](#веб-сайт-не-доступен)|
|ircPort|Порт для обмена данными с Twitch|Порт должен быть открыт в фаерволе/брандмауэре и виден из вне|

## commands
Объект настроек хранит коллекцию объектов отвечающих за настройку определенной чат команды.
<details>
  <summary>Объект commands</summary>
```json
{
    "commands": {
        "prefix": "!",
        "vote": {
            "name": "vote",
            "admin": true
        },
        "draw": {
            "name": "draw",
            "admin": false
        },
        "drawstop": {
            "name": "drawstop",
            "admin": true
        },
        "drawstart": {
            "name": "drawstart",
            "admin": true
        }
    }
}
``` 
</details>
| Ключ | Значение | Примечание |
|-|-|-|
|prefix|Символ приставки команд|Подобрная информация в разеде [Команды](#команды)<br>*Значение обязательно должно быть заключено в двойные кавычки!*|
|name|Название команды для её вызова|<br>*Значение обязательно должно быть заключено в двойные кавычки!*|
|admin|При значении `true` команда доступна только стримеру, `false` позволит любому пользователю использовать команду|Не рекомендуется изменять|
<details>
  <summary>Пример переименования чат команды `!draw` *розыгрыш* в `$PRIZE`:</summary>
  ```json
 {
    "twitch": {
        "password": "oauth:j8sw4m4ao19551vdpidp5e0c3zxguc",
        "login": "razie1l",
        "httpPort": 80,
        "ircPort": 433
    },
    "debug": {
        "twitch": false,
        "fakeUsers": false
    },
    "commands": {
        "prefix": "$",
        "vote": {
            "name": "vote",
            "admin": true
        },
        "draw": {
            "name": "PRIZE",
            "admin": false
        },
        "drawstop": {
            "name": "drawstop",
            "admin": true
        },
        "drawstart": {
            "name": "drawstart",
            "admin": true
        }
    }
}
  ```
</details>

# Интеграция с OBS
Вы можете отобразить прогресс ваших событий прямо на стриме.   
Для этого выполните следующие шаги: 
1. Запустите событие с помощью чат команды 
2. Перейдите на веб-сайт http://localhost:80 и откройте страницу с запущенным событием
3. Скопируйте URL страницы из браузера
4. В OBS создайте новый источник `Браузер` и вставьте ранее скопированный URL в поле `Адрес URL`

Удалите CSS свойства из соответствующего поля, чтобы сделать фон виджета непрозрачным.

# Изменение дизайна виджетов через OBS
Для изменения дизайна виджетов отредактируйте поле CSS выбрав `Браузер` в `Источники` OBS. 
![](https://github.com/raziEiL/twitch-events/blob/master/git-img/5.png)  
## Текст
За цвет текста виджетов отвечает CSS свойства `color`. Для изменения цвета пропишите новое значение `color` в элементе `body` (черный по умолчанию) и в классе `.color-a` для второстепенного цвета (красный по умолчанию). В примере ниже основной текст теперь томатный, а второстепенный бирюзовый.
```css
body {
    color: Tomato;
}
.color-a { 
    color: #008080; 
}
```
![](https://github.com/raziEiL/twitch-events/blob/master/git-img/1.png)
## Фон
За фоновый цвет виджетов отвечает CSS свойство `background` элемента `body`. По умолчанию используется белый цвет фона, в примере ниже розовый.
```css
body {
    background: hotpink;
}
```
![](https://github.com/raziEiL/twitch-events/blob/master/git-img/2.png)  
В этом примере прозрачный фон.
```css
body {
    background: rgba(0, 0, 0, 0);
}
```
![](https://github.com/raziEiL/twitch-events/blob/master/git-img/3.png)
## Фон элементов
Некоторые элементы используют класс `.color-bg-a` и `.color-bg-b` для применения цвета фона. Изменим цвет прогресса голосования на зеленый для первого участника и желтый для второго.
```css
.color-bg-a {
    background: green;
}
.color-bg-b {
    background: yellow;
}
```
![](https://github.com/raziEiL/twitch-events/blob/master/git-img/4.png)
# Как работает приложение
1. При запуске приложения происходит авторизация с Twitch API и предоставляется доступ к чату вашего Twitch канала. 
2. На вашем компьютере создается локальный веб-сервер, который по средствам REST API предоставляет данные Twitch обработанные приложением.
3. Данные отображаются в виде виджетов на веб-сайте доступным по адресу http://localhost:80. Виджеты позволяют следить за пользовательскими событиями вашего канала в реальном времени.

# Проблемы и решения
## Приложение закрывается
После сбоя в папке приложения создается `crash.log`. Откройте файл любым текстовым редактором и проверьте сообщения ошибок.  
Описание ошибок:  
`listen EADDRINUSE: address already in use :::80` - см. [Веб-сайт не доступен](#веб-сайт-не-доступен)  
`Configuration file not found in ...` - отсутствует файл конфигурации `config.json`  
При наличии других ошибок создайте [Issue](https://github.com/raziEiL/twitch-events/issues) и прикрепите файл `crash.log` 
## Чат команды не работают  
Проверьте консоль приложения на наличие сообщений `Failed to connect to Twitch channel` или `Login authentication failed`. При наличии данных сообщения проверьте правильность введенных данных авторизации в файле `config.json` (поля `password` и `login`). Вам может потребоваться сгенерировать пароль авторизации снова (см. раздел [Установка и запуск](#установка-и-запуск)). В случае отсутствии сообщений возможно был поврежден файл конфигурации `config.json`, попробуйте скачать приложение еще раз.
## Веб-сайт не доступен 
Причиной может быть использование порта на котором запущен веб-сервер другой программой. В таком случае отредактируйте поле `httpPort` файла конфигурации `config.json` и укажите любой свободный порт, например `3000`.

# Контакты
По вопросам сотрудничества свяжитесь со мной через:  
mr.raz4291@gmail.com  
[Steam](http://steamcommunity.com/id/raziEiL)  
[Discord сервер Alliance](https://discord.gg/pQPzazkpBq)
